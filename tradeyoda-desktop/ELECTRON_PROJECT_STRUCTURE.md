# Electron Project Structure

## âœ… Correct Directory Structure

```
/app/tradeyoda-desktop/
â”œâ”€â”€ package.json              â† ROOT (NPM commands run from here)
â”œâ”€â”€ electron/                 â† Electron source code
â”‚   â”œâ”€â”€ main.js              â† Main process
â”‚   â”œâ”€â”€ preload.js           â† IPC bridge
â”‚   â””â”€â”€ license-prompt.html  â† First-run UI
â”œâ”€â”€ assets/                   â† Icons for installer
â”‚   â”œâ”€â”€ icon.ico             â† Windows icon
â”‚   â”œâ”€â”€ icon.icns            â† Mac icon
â”‚   â””â”€â”€ icon.png             â† Linux icon
â”œâ”€â”€ build/                    â† Frontend build (Phase 3)
â”‚   â””â”€â”€ [React build output]
â”œâ”€â”€ release/                  â† Built installers (generated)
â”‚   â”œâ”€â”€ TradeYoda Setup 1.0.0.exe
â”‚   â””â”€â”€ TradeYoda-1.0.0.dmg
â””â”€â”€ [documentation].md
```

## âŒ Common Mistake

**Wrong:** `package.json` in `electron/` subdirectory
```
tradeyoda-desktop/
â””â”€â”€ electron/
    â””â”€â”€ package.json  â† WRONG LOCATION!
```

**Correct:** `package.json` at project root
```
tradeyoda-desktop/
â””â”€â”€ package.json      â† CORRECT LOCATION!
```

## Why Package.json Must Be at Root

1. **NPM/Yarn convention:** Commands like `npm run build` look for `package.json` in current directory
2. **Electron-builder:** Expects `package.json` at project root
3. **Dependency management:** `node_modules/` is created next to `package.json`

## Commands (Run from /app/tradeyoda-desktop/)

```bash
# Development
npm start                    # Run Electron in dev mode

# Production builds
npm run build                # Build for current platform
npm run build:win            # Build Windows installer
npm run build:mac            # Build Mac installer
npm run build:linux          # Build Linux AppImage
```

## What's in Each Directory

### electron/
**Purpose:** Electron main process code (Node.js)

**Files:**
- `main.js` - Application lifecycle, window management, backend spawning
- `preload.js` - Security bridge between Electron and React
- `license-prompt.html` - First-run license activation UI

**Language:** JavaScript (Node.js)

### build/
**Purpose:** Production React frontend build

**Created by:**
```bash
cd /app/tradeyoda/frontend
yarn build
# Output: dist/
cp -r dist /app/tradeyoda-desktop/build
```

**Language:** Static HTML/JS/CSS

### assets/
**Purpose:** Application icons for installers

**Files needed:**
- `icon.ico` - Windows (256x256)
- `icon.icns` - macOS (512x512)
- `icon.png` - Linux (512x512)

**How to create:** Use online icon converter or Photoshop

### release/
**Purpose:** Final installers

**Generated by:** `npm run build:win` or `npm run build:mac`

**Output:**
- Windows: `TradeYoda Setup 1.0.0.exe`
- Mac: `TradeYoda-1.0.0.dmg`
- Linux: `TradeYoda-1.0.0.AppImage`

## Current Status

âœ… **Phase 1 Complete:**
- Backend packaged with PyInstaller
- Located at: `/app/tradeyoda/dist/tradeyoda-backend/`

âœ… **Phase 2 Setup Complete:**
- Electron project structure created
- `package.json` at correct location (root)
- Main process (`electron/main.js`) created
- Preload script (`electron/preload.js`) created
- License prompt UI (`electron/license-prompt.html`) created
- Dependencies installed

â³ **Phase 2 Remaining:**
- Create app icons (assets/)
- Build frontend and copy to build/
- Test in development mode (`npm start`)

â³ **Phase 3 (Next):**
- Build and copy frontend
- Test complete integration

â³ **Phase 4 (Final):**
- Create installers
- Test installations

## Testing Development Mode

### Before building installers, test in dev mode:

```bash
# Terminal 1: Start backend manually
cd /app/tradeyoda
python3 backend_entrypoint.py

# Terminal 2: Start frontend dev server
cd /app/tradeyoda/frontend
yarn dev

# Terminal 3: Start Electron
cd /app/tradeyoda-desktop
npm start
```

**What happens:**
1. Electron window opens
2. First run â†’ Shows license prompt
3. Enter valid license key
4. Main app window opens
5. Frontend connects to backend

## Building Installers (After Testing)

### Prerequisites:
1. âœ… Backend built (`./build_backend.sh`)
2. âœ… Frontend built (`yarn build`)
3. âœ… Icons created (assets/)

### Build commands:

```bash
cd /app/tradeyoda-desktop

# Windows installer
npm run build:win

# Mac installer
npm run build:mac

# Output in release/
```

## Troubleshooting

### Error: "Could not read package.json"
**Problem:** Running commands from wrong directory
**Solution:** Always run from `/app/tradeyoda-desktop/` (where package.json is)

### Error: "electron: command not found"
**Problem:** Dependencies not installed
**Solution:** Run `npm install` from project root

### Error: "Cannot find module 'electron/main.js'"
**Problem:** Electron files missing
**Solution:** Check `electron/` directory exists with main.js

### License prompt doesn't show
**Problem:** License key file already exists
**Solution:** Delete cache:
```bash
rm -rf ~/Library/Application\ Support/TradeYoda  # Mac
# or
del /s "C:\Users\{user}\AppData\Roaming\TradeYoda"  # Windows
```

## Next Steps

1. âœ… Electron project setup complete
2. ğŸ“‹ Create app icons (optional for testing)
3. ğŸ“‹ Test in development mode
4. ğŸ“‹ Build frontend and integrate
5. ğŸ“‹ Build installers

See `DESKTOP_PACKAGING_GUIDE.md` for detailed Phase 2-4 implementation.
